<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guardia Digital</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- ICONOS Y FAVICONS -->
    <link rel="icon" type="image/png" href="fotos/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="fotos/favicon.svg" />
    <link rel="shortcut icon" href="fotos/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="fotos/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Guardia Digital" />
    <link rel="manifest" href="site.webmanifest" />
    
    <!-- META TAGS PWA para móviles -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0071e3">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Guardia Digital">
    <meta name="application-name" content="Guardia Digital">
    <meta name="msapplication-TileColor" content="#0071e3">
    <meta name="msapplication-TileImage" content="fotos/apple-touch-icon.png">
    <meta name="format-detection" content="telephone=no">
    <meta name="HandheldFriendly" content="true">
    <meta name="MobileOptimized" content="320">
    
    <!-- SEO y DESCRIPCIÓN -->
    <meta name="description" content="Tu aliado confiable en ciberseguridad empresarial. Protección 24/7, auditorías de seguridad y consultoría especializada.">
    <meta name="keywords" content="ciberseguridad, seguridad informática, protección empresarial, auditorías de seguridad, Chile">
    <meta name="author" content="Guardia Digital">
    
    <!-- ESTILOS Y FUENTES (mantener lo existente) -->
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

</head>
<body>
    <header class="header" id="header">
        <nav class="navbar container">
            <div class="nav-container">
                <div class="nav-logo">
                    <img src="fotos/logo.png" alt="Guardia Digital Logo">
                    <h2>GUARDIA DIGITAL</h2>
                </div>
                
                <ul class="nav-menu" id="nav-menu">
                    <li class="nav-item"><a href="#inicio" class="nav-link">Inicio</a></li>
                    <li class="nav-item"><a href="#servicios" class="nav-link">Servicios</a></li>
                    <li class="nav-item"><a href="#mision" class="nav-link">Misión</a></li>
                    <li class="nav-item"><a href="#contacto" class="nav-link">Contacto</a></li>
                </ul>
                
                <div class="visitor-counter-container">
                     <i class="fas fa-eye"></i>
                     <span id="visitor-count">0</span>
                </div>

                <button class="nav-toggle" id="mobile-menu" aria-label="Abrir menú">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
        </nav>
    </header>

    <section id="inicio" class="hero">
        <div class="hero-content container">
            <h1 class="hero-title">
                TU ALIADO CONFIABLE EN<br>
                CIBERSEGURIDAD EMPRESARIAL
            </h1>
            <p class="hero-description">
                En un mundo digital cada vez más complejo, sabemos que lo que realmente importa para tu empresa 
                es tener la tranquilidad de que tus datos y sistemas están protegidos. En Guardia Digital, 
                convertimos la ciberseguridad en algo simple y comprensible.
            </p>
        </div>
    </section>

    <section id="servicios" class="main-services">
        <div class="container">
            <h2>Protección Simple y Confiable</h2>
            <p>Te ayudamos a proteger tu empresa sin complicaciones. Hablamos en términos claros para que entiendas exactamente cómo mantenemos tu negocio seguro.</p>
            
            <div class="services-grid">
                <div class="service-card-new">
                    <div>
                        <div class="service-icon"><i class="fas fa-shield-alt"></i></div>
                        <h3>Revisión Completa de Seguridad</h3>
                        <p>Analizamos todos los puntos donde tu empresa podría estar en riesgo y te explicamos de manera simple qué necesitas proteger.</p>
                    </div>
                    <span class="pricing-highlight">Evaluación Gratuita</span>
                </div>
                
                <div class="service-card-new">
                    <div>
                        <div class="service-icon"><i class="fas fa-eye"></i></div>
                        <h3>Vigilancia 24/7 - Tu Guardia Digital</h3>
                        <p>Cuidamos tu empresa las 24 horas del día, todos los días del año. Si algo extraño sucede, actuamos inmediatamente.</p>
                    </div>
                    <span class="pricing-highlight">20% más económico</span>
                </div>
                
                <div class="service-card-new">
                    <div>
                        <div class="service-icon"><i class="fas fa-users-cog"></i></div>
                        <h3>Cumplimiento Legal Simplificado</h3>
                        <p>Te ayudamos a cumplir con todas las normas y regulaciones de seguridad sin que tengas que convertirte en un experto legal.</p>
                    </div>
                    <span class="pricing-highlight">Paquetes Escalables</span>
                </div>
                
                <div class="service-card-new">
                    <div>
                        <div class="service-icon"><i class="fas fa-graduation-cap"></i></div>
                        <h3>Capacitación Práctica para tu Equipo</h3>
                        <p>Enseñamos a tu equipo cómo mantenerse seguro en el día a día, con consejos prácticos y fáciles de aplicar.</p>
                    </div>
                    <span class="pricing-highlight">Descuentos Anuales</span>
                </div>
            </div>
        </div>
    </section>

    <section class="iot-section">
        <div class="container">
            <h2>Evaluación Gratuita - Sin Compromiso</h2>
            <p class="iot-description">
                Comenzamos ofreciéndote una evaluación completamente gratuita de la seguridad de tu empresa. 
                Sin tecnicismos, sin compromisos. Solo queremos que sepas exactamente dónde estás parado.
            </p>
            
            <div class="iot-services">
                <div class="iot-card">
                    <i class="fas fa-search" style="font-size: 48px;"></i>
                    <h3>1. Te Contamos Qué Encontramos</h3>
                    <div class="iot-details">
                        <p><strong>Revisamos tu empresa y te explicamos de manera simple dónde están los riesgos.</strong></p>
                        <ul>
                            <li>✓ Revisión básica de tus sistemas</li>
                            <li>✓ Identificamos los puntos más importantes a proteger</li>
                            <li>✓ Sabes exactamente cómo está tu empresa hoy</li>
                            <li>✓ Recomendaciones claras de qué hacer primero</li>
                        </ul>
                    </div>
                    <a href="#contacto" class="cta-button">Solicitar Evaluación</a>
                </div>
                
                <div class="iot-card">
                    <i class="fas fa-chart-line" style="font-size: 48px;"></i>
                    <h3>2. Creamos Tu Plan de Protección</h3>
                    <div class="iot-details">
                        <p><strong>Diseñamos un plan paso a paso, pensado específicamente para tu empresa y tu presupuesto.</strong></p>
                        <ul>
                            <li>✓ Plan adaptado a tu tipo de negocio</li>
                            <li>✓ Pasos claros y fechas realistas</li>
                            <li>✓ Avanzas de a poco, sin grandes inversiones</li>
                            <li>✓ Cada peso que inviertas tiene un propósito claro</li>
                        </ul>
                    </div>
                     <a href="#contacto" class="cta-button">Ver Ejemplo</a>
                </div>
                
                <div class="iot-card">
                    <i class="fas fa-handshake" style="font-size: 48px;"></i>
                    <h3>3. Te Acompañamos en el Camino</h3>
                    <div class="iot-details">
                        <p><strong>No te dejamos solo. Nuestro equipo está siempre disponible para ayudarte y responder tus dudas.</strong></p>
                        <ul>
                            <li>✓ Soporte en español cuando lo necesites</li>
                            <li>✓ Tu seguridad mejora constantemente</li>
                            <li>✓ Te concentras en hacer crecer tu negocio</li>
                        </ul>
                    </div>
                     <a href="#contacto" class="cta-button">Conocer Más</a>
                </div>
            </div>
        </div>
    </section>

    <section id="mision" class="mission-vision">
        <div class="container">
            <h2>Misión y Visión</h2>
            <div class="mv-grid">
                <div class="mv-card">
                    <h3>Misión</h3>
                    <p>
                        Proteger el presente y el futuro digital de las empresas en Chile, entregando soluciones de 
                        ciberseguridad robustas y fáciles de entender, a través de un equipo de expertos 
                        cercanos y comprometidos.
                    </p>
                </div>
                <div class="mv-card">
                    <h3>Visión</h3>
                    <p>
                        Ser líderes en soluciones tecnológicas de seguridad digital, destacándonos por nuestra 
                        innovación y profesionalismo, para construir un mundo digital más seguro donde las 
                        organizaciones puedan prosperar.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section id="contacto" class="contact-section">
        <div class="container">
            <div class="contact-content-wrapper">
                <div class="contact-info-wrapper">
                    <h3>Información de Contacto</h3>
                    <div class="contact-info-items">
                        <div class="contact-item"><i class="fas fa-map-marker-alt"></i><span>Santiago, Chile</span></div>
                        <div class="contact-item"><i class="fas fa-envelope"></i><span>contacto@guardiadigital.cl</span></div>
                        <div class="contact-item"><i class="fas fa-phone"></i><span>+56 9 59978963</span></div>
                        <div class="contact-item"><i class="fab fa-whatsapp"></i><a href="#" target="_blank" rel="noopener noreferrer"><span>WhatsApp</span></a></div>
                    </div>
                </div>
                
                <div class="contact-form-wrapper">
                    <h2>Solicitar Evaluación Gratuita</h2>
                    <form class="newsletter-form" id="contactForm">
                        <input type="text" name="nombre" placeholder="Nombre completo" required>
                        <input type="email" name="email" placeholder="Correo electrónico" required>
                        <input type="tel" name="telefono" placeholder="Teléfono">
                        <input type="text" name="empresa" placeholder="Nombre de la empresa">
                        <textarea name="mensaje" placeholder="Describe brevemente tus necesidades..." rows="4"></textarea>
                        <button type="submit">Solicitar Evaluación</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>GUARDIA DIGITAL</h3>
                    <p>Tu aliado confiable en ciberseguridad</p>
                    <div class="social-links">
                        <a href="#" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
                        <a href="#" aria-label="Imprimir"><i class="fas fa-print"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy;2025 by Guardia Digital. Todos los derechos reservados.</p>
                <div class="signature">
                    <p><strong>Universidad SEK</strong> - Plan de Marketing Digital</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- CHATBOT -->
    <button id="chat-toggle-button" aria-label="Abrir chat"><i class="fas fa-comments"></i></button>
    <div id="chatbot-container">
        <div class="chatbot-header">
             <div class="chatbot-title"><i class="fas fa-shield-alt"></i> Cyber Asistente</div>
             <button id="close-chat-btn" aria-label="Cerrar chat"><i class="fas fa-times"></i></button>
        </div>
        <div id="chatbot-messages"></div>
        <div id="chatbot-loading" style="display: none;">Escribiendo...</div>
        <form id="chatbot-form" class="chatbot-input-container">
            <input type="text" id="chatbot-input" placeholder="Escribe tu pregunta..." autocomplete="off">
            <button type="submit" aria-label="Enviar"><i class="fas fa-paper-plane"></i></button>
        </form>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Lógica General de la Página ---
            const header = document.getElementById('header');
            const menuButton = document.getElementById('mobile-menu');
            const mobileMenu = document.getElementById('nav-menu');
            
            // Header con scroll
            window.addEventListener('scroll', function() {
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });

            // Menú móvil
            if (menuButton && mobileMenu) {
                menuButton.addEventListener('click', function() {
                    mobileMenu.classList.toggle('active');
                    menuButton.classList.toggle('active');
                });

                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', () => {
                         mobileMenu.classList.remove('active');
                         menuButton.classList.remove('active');
                    });
                });
            }

            // --- CHATBOT CON SISTEMA DE RESPALDO ---
            const chatToggleButton = document.getElementById('chat-toggle-button');
            const chatbotContainer = document.getElementById('chatbot-container');
            const closeChatBtn = document.getElementById('close-chat-btn');
            const chatbotForm = document.getElementById('chatbot-form');
            const chatbotInput = document.getElementById('chatbot-input');
            const chatbotMessages = document.getElementById('chatbot-messages');
            const loadingIndicator = document.getElementById('chatbot-loading');

            // Configuración de APIs con respaldo
            const API_CONFIGS = [
                {
                    name: "Gemini 2.0 Flash",
                    key: "AIzaSyB2Gv6BvDX5UpWUMnIsx-CxyL5s8fWezyc",
                    url: "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",
                    timeout: 10000
                },
                {
                    name: "Gemini 1.5 Flash (respaldo)",
                    key: "AIzaSyB2Gv6BvDX5UpWUMnIsx-CxyL5s8fWezyc",
                    url: "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent",
                    timeout: 15000
                }
            ];

            // Respuestas predeterminadas como respaldo final
            const FALLBACK_RESPONSES = {
                saludo: "¡Hola! Soy el Cyber Asistente de Guardia Digital. Aunque tengo algunos problemas técnicos, puedo ayudarte con información básica sobre nuestros servicios de ciberseguridad.",
                servicios: "Ofrecemos: 1) Revisión Completa de Seguridad, 2) Vigilancia 24/7, 3) Cumplimiento Legal Simplificado, y 4) Capacitación para tu Equipo. ¿Te interesa alguno en particular?",
                contacto: "Puedes contactarnos en: contacto@guardiadigital.cl o llamar al +56 9 59978963. También puedes completar el formulario en esta página.",
                phishing: "El phishing son ataques que usan correos falsos para robar información. Siempre verifica el remitente antes de hacer clic en enlaces.",
                malware: "El malware es software malicioso. Mantén tu antivirus actualizado y no descargues archivos de fuentes no confiables.",
                default: "Disculpa, tengo problemas técnicos temporales. Para ayuda inmediata, contacta a nuestro equipo en contacto@guardiadigital.cl o +56 9 59978963."
            };

            if (chatToggleButton && chatbotContainer && closeChatBtn) {
                chatToggleButton.addEventListener('click', () => chatbotContainer.classList.toggle('active'));
                closeChatBtn.addEventListener('click', () => chatbotContainer.classList.remove('active'));
            }

            const addMessage = (sender, text) => {
                const messageContainer = document.createElement('div');
                messageContainer.classList.add('message', `${sender}-message`);
                
                const messageBubble = document.createElement('p');
                messageBubble.textContent = text;
                
                messageContainer.appendChild(messageBubble);
                chatbotMessages.appendChild(messageContainer);
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            };

            // Función para detectar tipo de pregunta
            const detectQuestionType = (input) => {
                const lowInput = input.toLowerCase();
                if (lowInput.includes('hola') || lowInput.includes('buenas')) return 'saludo';
                if (lowInput.includes('servicio') || lowInput.includes('ofrecen')) return 'servicios';
                if (lowInput.includes('contacto') || lowInput.includes('teléfono') || lowInput.includes('email')) return 'contacto';
                if (lowInput.includes('phishing') || lowInput.includes('fishing')) return 'phishing';
                if (lowInput.includes('malware') || lowInput.includes('virus')) return 'malware';
                return 'default';
            };

            // Función de respaldo con respuestas predeterminadas
            const getFallbackResponse = (userInput) => {
                const questionType = detectQuestionType(userInput);
                return FALLBACK_RESPONSES[questionType] || FALLBACK_RESPONSES.default;
            };

            // Función principal para obtener respuesta con múltiples intentos
            const getAIResponse = async (userInput) => {
                loadingIndicator.style.display = 'block';
                
                const prompt = `Eres un asistente virtual para GUARDIA DIGITAL, una empresa chilena de ciberseguridad. Tu nombre es 'Cyber Asistente'. 

Servicios que ofrecemos:
1. **Revisión Completa de Seguridad**: Analizamos riesgos y vulnerabilidades
2. **Vigilancia 24/7**: Monitoreo continuo de tu empresa
3. **Cumplimiento Legal Simplificado**: Ayuda con normas y regulaciones
4. **Capacitación Práctica**: Entrenamiento para tu equipo

Misión: Proteger el ecosistema digital de empresas chilenas con soluciones comprensibles.
Visión: Ser líderes en seguridad digital con innovación y profesionalismo.

Contacto: contacto@guardiadigital.cl | +56 9 59978963 | Santiago, Chile

Responde de forma amable, profesional y concisa en español. Si no sabes algo específico, ofrece contactar con un especialista.

Pregunta: "${userInput}"`;

                // Intentar con cada configuración de API
                for (let i = 0; i < API_CONFIGS.length; i++) {
                    const config = API_CONFIGS[i];
                    
                    try {
                        console.log(`🔄 Intentando con ${config.name}...`);
                        
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), config.timeout);
                        
                        const response = await fetch(`${config.url}?key=${config.key}`, {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json',
                                'User-Agent': 'GuardiaDigital-Chatbot/1.0'
                            },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                generationConfig: {
                                    temperature: 0.7,
                                    maxOutputTokens: 500
                                }
                            }),
                            signal: controller.signal
                        });

                        clearTimeout(timeoutId);

                        if (response.ok) {
                            const result = await response.json();
                            const botResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
                            
                            if (botResponse && botResponse.trim()) {
                                console.log(`✅ Éxito con ${config.name}`);
                                addMessage('bot', botResponse.trim());
                                return;
                            }
                        } else {
                            const errorData = await response.json();
                            console.log(`❌ Error ${response.status} con ${config.name}:`, errorData.error?.message);
                        }
                        
                    } catch (error) {
                        console.log(`❌ Fallo con ${config.name}:`, error.message);
                        // Continúa con la siguiente configuración
                    }
                }

                // Si todas las APIs fallan, usar respuesta predeterminada
                console.log('🔄 Usando respuesta de respaldo...');
                const fallbackResponse = getFallbackResponse(userInput);
                addMessage('bot', fallbackResponse);
                
                loadingIndicator.style.display = 'none';
            };

            // Manejo del formulario del chatbot
            if (chatbotForm) {
                chatbotForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const userInput = chatbotInput.value.trim();
                    if (userInput) {
                        addMessage('user', userInput);
                        chatbotInput.value = '';
                        getAIResponse(userInput);
                    }
                });
            }

            // Mensaje de bienvenida al abrir el chatbot
            let welcomeShown = false;
            chatToggleButton.addEventListener('click', () => {
                if (!welcomeShown && chatbotContainer.classList.contains('active')) {
                    setTimeout(() => {
                        addMessage('bot', '¡Hola! Soy el Cyber Asistente de Guardia Digital. ¿En qué puedo ayudarte hoy? Puedes preguntarme sobre nuestros servicios de ciberseguridad, consejos de seguridad, o información de contacto.');
                        welcomeShown = true;
                    }, 500);
                }
            });

            // Diagnóstico automático al cargar la página
            console.log('🔧 DIAGNÓSTICO DEL CHATBOT:');
            console.log('📅 Fecha:', new Date().toISOString());
            console.log('🌐 URL actual:', window.location.href);
            console.log('🔑 APIs configuradas:', API_CONFIGS.length);
            console.log('💾 Respuestas de respaldo:', Object.keys(FALLBACK_RESPONSES).length);
            console.log('✅ Sistema iniciado correctamente');
        });
    </script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="firebase-counter.js"></script>
    <script src="pwa-install.js"></script>

</body>
</html>
